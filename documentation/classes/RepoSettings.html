<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>wm-devops-console documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">wm-devops-console documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content class">
                   <div class="content-data">











<ol class="breadcrumb">
  <li>Classes</li>
  <li>RepoSettings</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/settings.ts</code>
        </p>





            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#configuration">configuration</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#name">name</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#packages">packages</a>
                            </li>
                        </ul>
                    </td>
                </tr>






        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(name: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, packages: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, configuration: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="7" class="link-to-prism">src/app/settings.ts:7</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>name</td>
                                                  
                                                        <td>
                                                                        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>packages</td>
                                                  
                                                        <td>
                                                                        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>configuration</td>
                                                  
                                                        <td>
                                                                        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="configuration"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            configuration</b>
                            <a href="#configuration"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="9" class="link-to-prism">src/app/settings.ts:9</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="name"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            name</b>
                            <a href="#name"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="9" class="link-to-prism">src/app/settings.ts:9</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="packages"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            packages</b>
                            <a href="#packages"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="9" class="link-to-prism">src/app/settings.ts:9</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
</section>







    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable } 	           	 					from &#x27;@angular/core&#x27;;
import { Router }					   					from &#x27;@angular/router&#x27;;
import { HttpClient, HttpHeaders, HttpParams }  		from &#x27;@angular/common/http&#x27;;
import { Observable, of }               		      	from &#x27;rxjs&#x27;;
import { switchMap, map, catchError, share } 			from &#x27;rxjs/operators&#x27;;

export class RepoSettings {

	constructor(public name: string, public packages: string, public configuration: string) {

	}
}

export enum GitType {
  github,
  gitlab
}

export class Values {

	public gitUri: string &#x3D; &quot;https://github.com/&quot;;
	public gitAPIUrl: string &#x3D; &quot;https://api.github.com&quot;;
	public gitType: GitType &#x3D; GitType.github;
	public gitName: string;
	public gitUser: string //&#x3D; &quot;johnpcarter&quot;;
	public gitIsPACPassword: string &#x3D; &quot;true&quot;;
	public gitPassword: string// &#x3D; &quot;jaghuc-cupWeq-hohve3&quot;;
	public gitRepos: RepoSettings[] &#x3D; [new RepoSettings(&quot;wm&quot;, &quot;/packages&quot;, &quot;/config&quot;)];

	public dockerHost: string &#x3D; null;
	public imagePrefix: string// &#x3D; &quot;jc&quot;;

	public lastViewedPage: string &#x3D; null;
	public lastViewedPageArg: string &#x3D; null;

	public k8sUrl: string &#x3D; &quot;https://localhost:6443&quot;
	public k8sNamespace: string &#x3D; null;
	public k8sToken: string &#x3D; null;

	public dockerEmail: string &#x3D; null;
	public dockerUserId: string &#x3D; null;
	public dockerPassword: string &#x3D; null;

	public empowerUserId: string &#x3D; null;
	public empowerPassword: string &#x3D; null;
	public empowerEncryptedPassword: string &#x3D; null;

	public repoForName(name: string): RepoSettings {

		let found: RepoSettings &#x3D; null;

		this.gitRepos.forEach((r) &#x3D;&gt; {

			if (r.name &#x3D;&#x3D; name) {
				found &#x3D; r;
			}
		});

		return found;
	}
}

@Injectable()
export class Settings {

	// Use if running in Dockerised Integration Server
	public static SERVER_API &#x3D; &quot;&quot;;
	public static DEV_SERVER_API &#x3D; &quot;http://host.docker.internal:5555&quot;;

	// Use if running in separate container on local machine
  // public static SERVER_API &#x3D; &quot;http://localhost:5555&quot;;
	// public static DEV_SERVER_API &#x3D; &quot;http://localhost:5555&quot;;

	public static WS_SERVER &#x3D; &quot;ws://localhost:9191&quot;;

	// runtime prefs

	public currentRuntime: string;
 	public gitExpander: boolean;
  	public dockerExpander: boolean;
  	public gatewayExpander: boolean;

  	// server managed settings

  	private _values: Values;
  	private _valuesLoaded: boolean;

	private static CONFIG: string &#x3D; Settings.SERVER_API + &quot;/rad/jc.devops:api/configuration/user&quot;;

	public constructor(private _http: HttpClient) {

		this._values &#x3D; new Values();

		this.values();
	}

	public values(): Observable&lt;Values&gt; {

		if (this._valuesLoaded) {

			console.log(&quot;getting preloaded settings&quot;);

			return of(this._values);
		}
		else {
			console.log(&quot;restoring settings&quot;);

			return this._restore().pipe(share());
		}
	}

	public setCurrentPage(page: string, arg?: string) {

		if (this._values.lastViewedPage !&#x3D; page) {
			this._values.lastViewedPage &#x3D; page;
			this._values.lastViewedPageArg &#x3D; arg;
			this.saveChanges();
		}
	}

	public setCurrentNamespace(namespace: string) {

		if (this._values.k8sNamespace !&#x3D; namespace) {
			this._values.k8sNamespace &#x3D; namespace;
			this.saveChanges();
		}
	}

	public gotoLastViewedPage(router: Router) {

		if (this._values.lastViewedPage) {

			if (this._values.lastViewedPageArg)
   				router.navigate([this._values.lastViewedPage, this._values.lastViewedPageArg]);
   			else
   				router.navigate([this._values.lastViewedPage]);

   			this._values.lastViewedPage &#x3D; null;
		}
	}

	public _restore(): Observable&lt;Values&gt; {

		let url: string &#x3D; Settings.CONFIG;
    	let headers &#x3D; new HttpHeaders()
                    .append(&#x27;Content-Type&#x27;, &#x27;application/json&#x27;)
                    .append(&#x27;Accept&#x27;, &#x27;application/json&#x27;)
                    .append(&#x27;Cache-Control&#x27;, &#x27;no-cache&#x27;)
                    .append(&#x27;Cache-Control&#x27;, &#x27;no-store&#x27;)
                    .append(&#x27;Pragma&#x27;,&#x27;no-cache&#x27;)
                    .append(&#x27;Expires&#x27;, &#x27;0&#x27;)
                    .append(&#x27;Accept&#x27;, &#x27;application/json&#x27;);

        let options: any &#x3D; { headers };

        return this._http.get(url, options).pipe(map((response) &#x3D;&gt; {

        	return this._cacheValues((&lt;any&gt; response).User);
        }));
	}

	public saveChanges() {

		let url: string &#x3D; Settings.CONFIG;
    	let headers &#x3D; new HttpHeaders()
                    .append(&#x27;Content-Type&#x27;, &#x27;application/json&#x27;)
                    .append(&#x27;Accept&#x27;, &#x27;application/json&#x27;)
                    .append(&#x27;Cache-Control&#x27;, &#x27;no-cache&#x27;)
                    .append(&#x27;Cache-Control&#x27;, &#x27;no-store&#x27;)
                    .append(&#x27;Pragma&#x27;,&#x27;no-cache&#x27;)
                    .append(&#x27;Expires&#x27;, &#x27;0&#x27;)
                    .append(&#x27;Accept&#x27;, &#x27;application/json&#x27;);

        let options: any &#x3D; { headers };

        let body: string &#x3D; JSON.stringify(this._values);

        return this._http.post(url, this._values, options).subscribe((response) &#x3D;&gt; {

        	console.log(&quot;response is &quot; + response);
        },
        error &#x3D;&gt; {return new Values()});
	}

	private _cacheValues(data: any): Values {

		if (data) {

			if (data.gitUri) {
				this._values.gitUri &#x3D; data.gitUri;

				this._values.gitType &#x3D; data.gitType &#x3D;&#x3D; 0 ? GitType.github : GitType.gitlab;

				if (this._values.gitType &#x3D;&#x3D; GitType.github) {
					let protoMarker: number &#x3D; data.gitUri.indexOf(&quot;//&quot;);
					this._values.gitAPIUrl &#x3D; data.gitUri.substring(0, protoMarker) + &quot;//api.&quot; + data.gitUri.substring(protoMarker + 2);
				} else {
					this._values.gitAPIUrl &#x3D; this._values.gitUri;
				}
			}

			//if (data.gitAPIUrl)
			//	this._values.gitAPIUrl &#x3D; data.gitAPIUrl;

			if (data.gitUser)
				this._values.gitUser &#x3D; data.gitUser;

			if (data.gitName)
				this._values.gitName &#x3D; data.gitName;

			if (data.gitPassword)
				this._values.gitPassword &#x3D; data.gitPassword;

			if (data.gitType)
			  this._values.gitType &#x3D; data.gitType &#x3D;&#x3D; 0 ? GitType.github : GitType.gitlab;

			if (data.gitIsPACPassword)
				this._values.gitIsPACPassword &#x3D; data.gitIsPACPassword;

			if (data.gitRepos) {

				this._values.gitRepos &#x3D; [];

				data.gitRepos.forEach((r) &#x3D;&gt; {
					this._values.gitRepos.push(new RepoSettings(r.name, r.packages, r.configuration));
				});
			}

			if (data.dockerHost)
				this._values.dockerHost &#x3D; data.dockerHost;

			if (data.imagePrefix)
				this._values.imagePrefix &#x3D; data.imagePrefix;

			if (data.k8sUrl)
				this._values.k8sUrl &#x3D; data.k8sUrl;

			if (data.k8sNamespace)
				this._values.k8sNamespace &#x3D; data.k8sNamespace;

			if (data.k8sToken)
				this._values.k8sToken &#x3D; data.k8sToken;

			if (data.dockerEmail)
				this._values.dockerEmail &#x3D; data.dockerEmail;

			if (data.dockerUserId)
				this._values.dockerUserId &#x3D; data.dockerUserId;

			if (data.dockerPassword)
				this._values.dockerPassword &#x3D; data.dockerPassword;

			if (data.empowerUserId)
				this._values.empowerUserId &#x3D; data.empowerUserId;

			if (data.empowerPassword)
				this._values.empowerPassword &#x3D; data.empowerPassword;

			if (data.empowerEncryptedPassword)
				this._values.empowerEncryptedPassword &#x3D; data.empowerEncryptedPassword;

			if (data.lastViewedPage)
				this._values.lastViewedPage &#x3D; data.lastViewedPage;

			if (data.lastViewedPageArg)
				this._values.lastViewedPageArg &#x3D; data.lastViewedPageArg;
		}

		console.log(&quot;loaded settings: &quot; + this._values.dockerHost);

		this._valuesLoaded &#x3D; true;

		return this._values;
	}
}
</code></pre>
    </div>
</div>



                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'class';
            var COMPODOC_CURRENT_PAGE_URL = 'RepoSettings.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
