<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>wm-devops-console documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">wm-devops-console documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content class">
                   <div class="content-data">











<ol class="breadcrumb">
  <li>Classes</li>
  <li>ServiceInfo</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/components/test-definition.component.ts</code>
        </p>





            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#endpoint">endpoint</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#mocks">mocks</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#tests">tests</a>
                            </li>
                        </ul>
                    </td>
                </tr>






        </tbody>
    </table>
</section>


            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="endpoint"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            endpoint</b>
                            <a href="#endpoint"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="34" class="link-to-prism">src/app/components/test-definition.component.ts:34</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="mocks"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            mocks</b>
                            <a href="#mocks"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>any[]</code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="36" class="link-to-prism">src/app/components/test-definition.component.ts:36</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="tests"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            tests</b>
                            <a href="#tests"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>TestCase[]</code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="35" class="link-to-prism">src/app/components/test-definition.component.ts:35</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
</section>







    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Component, ChangeDetectorRef,
			OnInit, OnDestroy, ViewChild }   				from &#x27;@angular/core&#x27;;

import { Router }									  	    from &#x27;@angular/router&#x27;;
import {FormBuilder, FormGroup, FormControl,
								Validators} 			   	from &#x27;@angular/forms&#x27;;
import { SelectionModel }                             		from &#x27;@angular/cdk/collections&#x27;;

import { MediaMatcher }                               		from &#x27;@angular/cdk/layout&#x27;;
import { MatAccordion, MatStepper, MatInput, MatButton,
	MatDialog, MatDialogRef, MatPaginator, MAT_DIALOG_DATA }from &#x27;@angular/material&#x27;;
import { MatTableDataSource } 								from &#x27;@angular/material/table&#x27;;

import { Settings }                                   	  	from &#x27;../settings&#x27;;

import { DockerImage, TestStatus } 							from &#x27;../models/docker-image&#x27;;
import { Source }                                     	  	from &#x27;../models/git-source&#x27;;
import { RunSet, Builder, DeploymentSet,
  Probe, Port, Arg, Stage, Container }       				from &#x27;../models/project&#x27;;
import { WmPackageInfo, APIDefinition }               	  	from &#x27;../models/wm-package-info&#x27;;
import { TestSuite }										from &quot;../models/test-suite&quot;;
import { TestCase }											from &quot;../models/test-case&quot;;

import { ResourceService }                                	from &#x27;../services/resources.service&#x27;;
import { DockerService } 				          	    	from &#x27;../services/docker.service&#x27;;
import { ConfigurationService }                    		    from &#x27;../services/configuration.service&#x27;;
import { PackagesService }									from &#x27;../services/packages.service&#x27;;
import { TestConfigService }								from &#x27;../services/test-config.service&#x27;;

import { ContainerTemplates }							   	from &#x27;../support/container.templates&#x27;;

export class ServiceInfo {

	public endpoint: string;
	public tests: TestCase[];
	public mocks: any[];
}

@Component({
  selector: &#x27;test-definitions&#x27;,
  templateUrl: &#x27;../templates/test-definition.html&#x27;,
  styleUrls: [&#x27;../templates/test-definition.css&#x27;]
})

export class TestDefinitionComponent implements OnInit {

	public panelOpenState: any;
	public length;
	public pageSize;
	public pageEvent;

	public packageChooserFormGroup: FormGroup;
	public servicesFormGroup: FormGroup;
	public testCaseFormGroup: FormGroup;

	public selectedPackageCtrl: FormControl;
	public selectedServiceCtrl: FormControl;

	public packageTableDataSource: MatTableDataSource&lt;WmPackageInfo&gt;;
	public packages: WmPackageInfo[];

	public selectedPackage: WmPackageInfo;

	public servicesTableDataSource: MatTableDataSource&lt;ServiceInfo&gt;;
	public servicesAndAPIsForSelectedPackage: ServiceInfo[];
	public currentTestSuite: TestSuite;
	public currentTestSuiteEndpoints: any[];

	public selectedService: ServiceInfo;
	public selectedTestCase: TestCase;
	public isNewTestCase: boolean;

	public displayedPackageColumns: string[] &#x3D; [&quot;name&quot;, &quot;version&quot;, &quot;apis&quot;, &quot;status&quot;];
	public displayedServicesColumns: string[] &#x3D; [&quot;name&quot;, &quot;tests&quot;];

	@ViewChild(&#x27;stepper&#x27;)
	public stepper: MatStepper;

	@ViewChild(&#x27;packagesPaginator&#x27;)
	public packagesPaginator: MatPaginator;

	@ViewChild(&#x27;servicesPaginator&#x27;)
	public servicesPaginator: MatPaginator;

	public constructor(private _router: Router, private _settings: Settings, private _dockerService: DockerService, private _dialog: MatDialog,
		private _formBuilder: FormBuilder, private _resources: ResourceService, private _configService: ConfigurationService, private _testSuiteConfig: TestConfigService) {

     	this._testSuiteConfig.packages().subscribe((p) &#x3D;&gt; {

     		this.packages &#x3D; p;

     		this.packageTableDataSource &#x3D; new MatTableDataSource(p);
			this.packageTableDataSource.paginator &#x3D; this.packagesPaginator;

			this.packages.forEach((p) &#x3D;&gt; {

				if (p.testStatus !&#x3D; TestStatus.none) {

					this._testSuiteConfig.getTestSuiteDefinition(p.name).subscribe((testSuites) &#x3D;&gt; {
						p[&#x27;testCounts&#x27;] &#x3D; testSuites[0].tests.size;
					});
				} else {
					p[&#x27;testCounts&#x27;] &#x3D; 0;
				}
			});
     	});

     	this.selectedPackageCtrl &#x3D; new FormControl(null, Validators.required);
     	this.selectedServiceCtrl &#x3D; new FormControl(null, Validators.required);

     	this.packageChooserFormGroup &#x3D; _formBuilder.group({selectedPackageCtrl: this.selectedPackageCtrl});
     	this.servicesFormGroup &#x3D; _formBuilder.group({selectedServiceCtrl: this.selectedServiceCtrl});
     	this.testCaseFormGroup &#x3D; _formBuilder.group({});
	}

	public ngOnInit() {

	}

	public haveTests(element: WmPackageInfo): boolean {

		return element.testStatus !&#x3D; null &amp;&amp; element.testStatus !&#x3D; TestStatus.none
	}

	public testLabelFor(container: WmPackageInfo): string {

		let s: string &#x3D; &quot;&quot;;

		if (container.testStatus &#x3D;&#x3D; TestStatus.none)
			s &#x3D; &quot;No test cases defined&quot;;
		else if (container.testStatus &#x3D;&#x3D; TestStatus.passed)
			s &#x3D; &quot;All test cases pased successfully&quot;;
		if (container.testStatus &#x3D;&#x3D; TestStatus.failed)
			s &#x3D; &quot;Some test cases failed&quot;;
		if (container.testStatus &#x3D;&#x3D; TestStatus.running)
			s &#x3D; &quot;Test Cases are running&quot;;
		if (container.testStatus &#x3D;&#x3D; TestStatus.todo)
			s &#x3D; &quot;Test cases defined, but not yet run&quot;;

		return s;
	}

	public todoTests(element: WmPackageInfo): boolean {

		return element.testStatus &#x3D;&#x3D; TestStatus.todo;
	}

	public runningTests(element: WmPackageInfo): boolean {

		return element.testStatus &#x3D;&#x3D; TestStatus.todo;
	}

	public failedTests(element: WmPackageInfo): boolean {

		return element.testStatus &#x3D;&#x3D; TestStatus.failed;
	}

	public passedTests(element: WmPackageInfo): boolean {

		return element.testStatus &#x3D;&#x3D; TestStatus.passed;
	}

	public showTestResults(container: Container) {

		window.open(Settings.SERVER_API + &quot;/JcTestSuite&quot;, &quot;test&quot;);
	}

	public selectPackage(packageInfo: WmPackageInfo) {

		this._testSuiteConfig.getTestSuiteDefinition(packageInfo.name).subscribe((testSuites) &#x3D;&gt; {
			this.currentTestSuite &#x3D; testSuites[0];

			this.selectedPackageCtrl.setValue(packageInfo.name);

			this.setupEndPointsForCurrentTestSuite();

			this._testSuiteConfig.packageDetails(packageInfo.name).subscribe((p) &#x3D;&gt; {
				this.selectedPackage &#x3D; p;

				this.servicesAndAPIsForSelectedPackage &#x3D; [];

				this.selectedPackage.services.forEach((s) &#x3D;&gt; {
					let si: ServiceInfo &#x3D; new ServiceInfo();
					si.endpoint &#x3D; s;
					si.tests &#x3D; [];

					this.currentTestSuite.tests.forEach((t) &#x3D;&gt; {

						if (t.endpoint &#x3D;&#x3D; si.endpoint)
							si.tests.push(t);
					});

					this.servicesAndAPIsForSelectedPackage.push(si);
				});

				this.selectedPackage.apis.forEach((a) &#x3D;&gt; {

					let si: ServiceInfo &#x3D; new ServiceInfo();
					si.endpoint &#x3D; a.name;
					si.tests &#x3D; [];

					this.currentTestSuite.tests.forEach((t) &#x3D;&gt; {

						if (a.swaggerEndPoint.indexOf(t.api) !&#x3D; -1)
							si.tests.push(t);
					});

					this.servicesAndAPIsForSelectedPackage.push(si)
				});

				this.servicesTableDataSource &#x3D; new MatTableDataSource(this.servicesAndAPIsForSelectedPackage);
				this.servicesTableDataSource.paginator &#x3D; this.servicesPaginator;
			});
		});
	}

	public selectService(service: ServiceInfo) {

		this.selectedServiceCtrl.setValue(service.endpoint);
		this.selectedService &#x3D; service;
	}

	public colorForTestSuite(pckg: WmPackageInfo) {

		if (pckg.testStatus &#x3D;&#x3D; TestStatus.failed)
			return &quot;warn&quot;;
		else
			return &quot;primary&quot;;
	}

	public setupEndPointsForCurrentTestSuite() {

		let keys: IterableIterator&lt;string&gt; &#x3D; this.currentTestSuite.tests.keys();
		let key: IteratorResult&lt;string&gt; &#x3D; keys.next();

		this.currentTestSuiteEndpoints &#x3D; [];

		while(!key.done) {
			let v: any &#x3D; {};
			v.endpoint &#x3D; this.currentTestSuite.tests.get(key.value).endpoint;
			v.isAPI &#x3D; this.currentTestSuite.tests.get(key.value).apiMethod !&#x3D; null;
			v.tests &#x3D; [];
			v.tests.push(this.currentTestSuite.tests.get(key.value));

			let existing: any &#x3D; null;

			if ((existing&#x3D;this.inList(v, this.currentTestSuiteEndpoints)) &#x3D;&#x3D; null)
				this.currentTestSuiteEndpoints.push(v);
			else
				existing.tests.push(this.currentTestSuite.tests.get(key.value));

			key &#x3D; keys.next();
		}
	}

	public testCountForTestSuite(pckg: WmPackageInfo) {

		return pckg[&#x27;testCounts&#x27;];
	}

	public haveTestsForService(service: ServiceInfo) {

		return service.tests.length &gt; 0;
	}

	public testCountForService(service: ServiceInfo) {

		return service.tests.length;
	}

	public colorForEndpoint(endpoint: any) {

		if (endpoint.isAPI)
			return &quot;accent&quot;;
		else
			return &quot;primary&quot;;
	}

	public selectServiceChip(service: ServiceInfo) {

		this.selectService(service);
		this.stepper.next();
	}

	public selectTestCaseChip(testCase: TestCase) {

		this.isNewTestCase &#x3D; false;
		this.selectedTestCase &#x3D; testCase;
		this.stepper.next();
	}

	public stepChanged(event: any) {

		if (event.selectedIndex &#x3D;&#x3D; 2 &amp;&amp; event.previouslySelectedIndex &#x3D;&#x3D; 1 &amp;&amp; this.selectedTestCase &#x3D;&#x3D; null) {

			this.selectedTestCase &#x3D; new TestCase();
			this.selectedTestCase.suiteId &#x3D; this.currentTestSuite.id();
			this.selectedTestCase.endpoint &#x3D; this.selectedService.endpoint;
			this.isNewTestCase &#x3D; true;
		} else if (event.previouslySelectedIndex &#x3D;&#x3D; 2) {
			this.selectedTestCase &#x3D; null;
		}
	}

	public testCaseUpdated(testCase: TestCase) {

		if (this.isNewTestCase) {

			// do nothing, until new test case is confirmed

		} else {

			this.saveChanges();
		}
	}

	public saveNewTestCase() {

		this.isNewTestCase &#x3D; false;

		this.currentTestSuite.tests.set(this.selectedTestCase.id(), this.selectedTestCase);
	}

	public removeTestCase(testCase: TestCase) {

		this.currentTestSuite.tests.delete(testCase.id());
		this.saveChanges();

		this.selectedService.tests &#x3D; [];

		this.currentTestSuite.tests.forEach((t) &#x3D;&gt; {

			if (t.endpoint &#x3D;&#x3D; this.selectedService.endpoint)
				this.selectedService.tests.push(t);
		});
	}

	private saveChanges() {

	}

	private inList(a: any, list: any[]): any {

		let found: any &#x3D; null;

		this.currentTestSuiteEndpoints.forEach((e) &#x3D;&gt; {
			if (e.endpoint &#x3D;&#x3D; a.endpoint)
				found &#x3D; e;
		});

		return found;
	}
}
</code></pre>
    </div>
</div>



                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'class';
            var COMPODOC_CURRENT_PAGE_URL = 'ServiceInfo.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
